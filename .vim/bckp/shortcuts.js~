(function($) {

    $.Shortcuts.add({
        type: 'down',
        mask: 'Ctrl+A',
        //description: 'Выделить все письма',
        handler: function() {
            Table.active.toggleSelectAll();
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Shift',
        handler: function() {
            Table.active.startKeyboardSelect();
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'hold',
        mask: 'Up',
        //description: 'К предыдущему письму',
        handler: function() {
            Table.active.moveCurrentUp();
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'hold',
        mask: 'Shift+Up',
        //description: 'К предыдущему письму с выделением',
        handler: function() {
            Table.active.moveCurrentUp(true);
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'hold',
        mask: 'Down',
        //description: 'К следующему письму',
        handler: function() {
            Table.active.moveCurrentDown();
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'hold',
        mask: 'Shift+Down',
        //description: 'К следующему письму с выделением',
        handler: function() {
            Table.active.moveCurrentDown(true);
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Home',
        //description: 'К первому письму',
        handler: function() {
            Table.active.moveCurrentHome();
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Shift+Home',
        //description: 'К первому письму с выделением',
        handler: function() {
            Table.active.moveCurrentHome(true);
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'End',
        //description: 'К последнему письму',
        handler: function() {
            Table.active.moveCurrentEnd();
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Shift+End',
        //description: 'К последнему письму с выделением',
        handler: function() {
            Table.active.moveCurrentEnd(true);
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Space',
        //description: 'Выделить текущее письмо',
        handler: function(e) {
            Table.active.selectCurrent(e);
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Enter',
        //description: 'Открыть текущее письмо',
        handler: function() {
            Table.active.openCurrent();
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Right',
        //description: 'Развернуть тред',
        handler: function() {
            Table.active.openThread();
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Left',
        //description: 'Свернуть тред',
        handler: function() {
            Table.active.closeThread();
        },
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Delete',
        //description: 'Удалить письма',
        action: 'delete',
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Ctrl+Right',
        //description: 'Перейти к следующей странице в пейджере',
        action: 'messages.next',
        list: 'messages'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Ctrl+Left',
        //description: 'Перейти к предыдущей странице в пейджере',
        action: 'messages.prev',
        list: 'messages'
    });

    // Тестовый экшен -- раскрыть все непрочитанные треды
    /*
    $.Shortcuts.add({
        type: 'down',
        mask: 'Alt+O',
        description: 'Раскрыть все непрочитанные треды',
        action: 'thread.openall',
        list: 'messages'
    });
    */

    /* ------------------------------------------------------------------------------------------------------------- */

    $.Shortcuts.add({
        type: 'down',
        mask: 'Ctrl+Right',
        //description: 'Перейти к следующему письму',
        action: 'message.next',
        list: 'message'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Ctrl+Left',
        //description: 'Перейти к предыдущему письму',
        action: 'message.prev',
        list: 'message'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Delete',
        //description: 'Удалить письмо',
        action: 'delete',
        list: 'message'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Ctrl+R',
        //description: 'Ответить',
        action: 'reply',
        list: 'message'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Ctrl+Shift+R',
        //description: 'Ответить всем',
        action: 'reply-all',
        list: 'message'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'Ctrl+L',
        //description: 'Переслать',
        action: 'forward',
        list: 'message'
    });

    /* ------------------------------------------------------------------------------------------------------------- */

    $.Shortcuts.add({
        type: 'down',
        mask: 'Ctrl+S',
        //description: 'Сохранить как черновик',
        enableInInput: true,
        action: 'compose.save',
        list: 'compose'
    });

    /* ------------------------------------------------------------------------------------------------------------- */

    $.Shortcuts.add({
        type: 'down',
        mask: 'Esc',
        enableInInput: true,
        handler: function() {
            Daria.Dialog.cancel();
        },
        list: 'dialog'
    });

    /* ------------------------------------------------------------------------------------------------------------- */

    $.Shortcuts.add({
        type: 'hold',
        mask: 'J',
        //description: 'К предыдущему посту',
        handler: function() {
            var lentaPostsBox = Daria.Block.blocks['lenta-posts-box'];
            if (lentaPostsBox && lentaPostsBox.active){
                lentaPostsBox.active.moveCurrentDown();
            }
        },
        list: 'lenta-index'
    });

    $.Shortcuts.add({
        type: 'hold',
        mask: 'K',
        //description: 'К следующему посту',
        handler: function() {
            var lentaPostsBox = Daria.Block.blocks['lenta-posts-box'];
            if (lentaPostsBox && lentaPostsBox.active){
                lentaPostsBox.active.moveCurrentUp();
            }
        },
        list: 'lenta-index'
    });

    $.Shortcuts.add({
        type: 'down',
        mask: 'U',
        //description: 'DEBUG: пометить все непрочитанными',
        handler: function() {
            var lentaPostsBox = Daria.Block.blocks['lenta-posts-box'];
            if (lentaPostsBox && lentaPostsBox.active){
                Actions.run("lenta-post.mark-read", {}, {ids: lentaPostsBox.active.getIds()});
            }
        },
        list: 'lenta-index'
    });

    /* ------------------------------------------------------------------------------------------------------------- */

    $.Shortcuts.start('messages');

    /* ------------------------------------------------------------------------------------------------------------- */

    Daria.events.bind("pageType.change", function(e, diff) {
        $.Shortcuts.start(diff.value);
    });

}(jQuery));
