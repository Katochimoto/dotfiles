(function($, Daria) {

    /**
     * Массив сообщений.
     * @type Array
     */
    var Log = [];

    /**
     * Логгер для транспорта. Такая штука очень хорошо себя зарекомендовала в чате.
     * Открывается по Ctrl+\.
     * @param {String} e Название сообщения.
     * @param {String} msg Сообщение, которое надо залогировать.
     */
    Daria.Transport.log = function(e, msg) {
        var save = {
            'tm': new Date().getTime()
        };
        save[e || 'msg'] = msg;
        if (window.JSON && JSON.stringify) {
            Log.push(JSON.stringify(save));
        } else {
            var json = ['{'];
            for (var i in save) {
                if (save.hasOwnProperty(i)) {
                    json.push('"' + i + '":"' + save[i] + '",')
                }
            }
            json.push('}');
            Log.push(json.join(''));
        }
        
    };
/*
    $('body').delegate('#__roster_logger_close', 'click', function() {
        $('#__roster_logger').remove();
        return false;
    });
*/
    $(document).bind('keydown', function(e) {
        if (e.ctrlKey && e.keyCode == 220) {
            $('#__roster_logger').remove();
            $('<div id="__roster_logger" style="background:#FFF;border:2px solid #000;width:300px;height:300px;position:absolute;top:0;right:0;z-index:999">' +
                   '<a href="#_roster_logger_close" id="__roster_logger_close">x</a>' +
                   '<textarea style="width:100%;height:100%" rows="20" cols="10"></textarea>' +
                   '</div>').
                    appendTo('body').
                    find('textarea').
                    val('[' + Log.join(',') + ']');
        }
    });
})(jQuery, Daria);
