<?xml version="1.0" encoding="utf-8"?>

<handlers xmlns:xi="http://www.w3.org/2001/XInclude">

    <mist method="set_state_by_request" xpointer="/..">
        <param type="String"/>
    </mist>

    <xi:include href="../cfg/wmi-host.xml"/>
    <xi:include href="../cfg/webchat-host.xml"/>

    <lua xpointer="/..">
        <![CDATA[
            -- os.execute('sleep 3')
            method = xscript.request:getMethod()
            if (method == 'POST') then
                 xscript.state:setString('is_post', 'true')
            end

            locale = 'ru' -- FIXME: Брать локаль откуда-нибудь.
            xscript.state:setString('locale-suffix', '.' .. locale .. '.xml')
        ]]>
    </lua>




    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-folder-update</guard>
        <param type="String">settings/do-folder-update.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-folder-rename</guard>
        <param type="String">folders/do-folder-rename.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-settings</guard>
        <param type="String">settings/do-settings.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-settings-all</guard>
        <param type="String">settings/do-settings-all.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-webchat-settings</guard>
        <param type="String">webchat/do-webchat-settings.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-webchat-history-delete-all</guard>
        <param type="String">webchat/do-webchat-history-delete-all.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="300000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-send</guard>
        <param type="String">compose/do-send.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-messages</guard>
        <param type="String">messages/do-messages.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-label</guard>
        <param type="String">messages/do-label.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-labels-delete</guard>
        <param type="String">labels/do-labels-delete.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-label-edit</guard>
        <param type="String">labels/do-label-edit.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-unlabel</guard>
        <param type="String">messages/do-unlabel.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-accept-email</guard>
        <param type="String">filters/do-filters-accept-email.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-on</guard>
        <param type="String">filters/do-filters-on.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-off</guard>
        <param type="String">filters/do-filters-off.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-blacklist-add</guard>
        <param type="String">filters/do-filters-blacklist-add.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-blacklist-remove</guard>
        <param type="String">filters/do-filters-blacklist-remove.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-whitelist-add</guard>
        <param type="String">filters/do-filters-whitelist-add.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-whitelist-remove</guard>
        <param type="String">filters/do-filters-whitelist-remove.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-delete</guard>
        <param type="String">filters/do-filters-delete.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-add</guard>
        <param type="String">filters/do-filters-add.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-edit</guard>
        <param type="String">filters/do-filters-edit.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-filters-sort</guard>
        <param type="String">filters/do-filters-sort.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-folders-add</guard>
        <param type="String">folders/do-folders-add.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-folder-remove</guard>
        <param type="String">folders/do-folder-remove.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-folder-clear</guard>
        <param type="String">folders/do-folder-clear.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-folder-mark-read</guard>
        <param type="String">folders/do-folder-mark-read.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-labels-add</guard>
        <param type="String">labels/do-labels-add.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-collector-check</guard>
        <param type="String">collector/do-collector-check.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-collector-create</guard>
        <param type="String">collector/do-collector-create.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-collector-edit</guard>
        <param type="String">collector/do-collector-edit.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-collector-remove</guard>
        <param type="String">collector/do-collector-remove.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-collector-on</guard>
        <param type="String">collector/do-collector-on.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-collector-off</guard>
        <param type="String">collector/do-collector-off.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-abook-person-add</guard>
        <param type="String">abook/do-abook-person-add.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-abook-person-delete</guard>
        <param type="String">abook/do-abook-person-delete.xml</param>
    </file>

    <file method="invoke" threaded="no" timeout="30000">
        <guard type="StateArg">is_post</guard>
        <guard type="StateArg">handler.do-abook-person-update</guard>
        <param type="String">abook/do-abook-person-update.xml</param>
    </file>

    <file method="invoke">
        <guard type="StateArg">handler.do-abook-import-contacts</guard>
        <param type="String">abook/do-abook-import-contacts.xml</param>
    </file>




    <file method="invoke">
        <guard type="StateArg">handler.toolbar</guard>
        <param type="String">toolbar/toolbar</param>
        <param type="StateArg">locale-suffix</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.filters</guard>
        <param type="String">filters/filters.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.filters-whitelist</guard>
        <param type="String">filters/filters-whitelist.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.filters-blacklist</guard>
        <param type="String">filters/filters-blacklist.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.filters-check-owner</guard>
        <param type="String">filters/filters-check-owner.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.folders</guard>
        <param type="String">folders/folders.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.labels</guard>
        <param type="String">labels/labels.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.messages</guard>
        <param type="String">messages/messages.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.message</guard>
        <param type="String">message/message.xml</param>
    </file>

    <file method="invoke" xslt="message/message-body.xsl" timeout="30000">
        <guard type="StateArg">handler.message-body</guard>
        <param type="String">message/message-body.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.message-narod-attach</guard>
        <param type="String">message/message-narod-attach.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.message-nearest</guard>
        <param type="String">message/message-nearest.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.message-thread-nearest</guard>
        <param type="String">message/message-thread-nearest.xml</param>
    </file>

    <file method="invoke" xslt="settings/settings.xsl" timeout="30000">
        <guard type="StateArg">handler.settings</guard>
        <param type="String">settings/settings.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.webchat-settings</guard>
        <param type="String">webchat/webchat-settings.xml</param>
    </file>

    <file method="invoke" timeout="30000">
        <guard type="StateArg">handler.setup-menu</guard>
        <param type="String">settings/setup-menu.xml</param>
    </file>

    <file method="invoke">
        <guard type="StateArg">handler.settings-color-schemes</guard>
        <param type="String">settings/settings-color-schemes.xml</param>
    </file>

    <file method="invoke" xslt="account-information/account-information.xsl" timeout="30000">
        <guard type="StateArg">handler.account-information</guard>
        <param type="String">account-information/account-information.xml</param>
    </file>

    <file method="invoke">
        <guard type="StateArg">handler.abook-letters</guard>
        <param type="String">abook/abook-letters.xml</param>
    </file>

    <file method="invoke">
        <guard type="StateArg">handler.abook-contacts</guard>
        <param type="String">abook/abook-contacts.xml</param>
    </file>

    <file method="invoke">
        <guard type="StateArg">handler.collector</guard>
        <param type="String">collector/collector.xml</param>
    </file>

    <file method="invoke">
        <guard type="StateArg">handler.collectors</guard>
        <param type="String">collector/collectors.xml</param>
    </file>

    <!--
    <file method="invoke">
        <guard type="StateArg">handler.is-yandex-user</guard>
        <param type="String">account-information/is-yandex-user.xml</param>
    </file>
    -->

    <file method="invoke">
        <guard type="StateArg">handler.informer-news</guard>
        <param type="String">informers/news.xml</param>
    </file>

    <file method="invoke">
        <guard type="StateArg">handler.banner</guard>
        <param type="String">informers/banner.xml</param>
    </file>

    <file method="invoke">
        <guard type="StateArg">handler.debug-settings</guard>
        <param type="String">debug/debug-settings.xml</param>
    </file>

    <file method="invoke">
        <guard type="StateArg">handler.postcards</guard>
        <param type="String">compose/postcards.xml</param>
    </file>

</handlers>

